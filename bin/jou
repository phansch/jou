#!/usr/bin/env ruby

require_relative '../lib/jou'
require_relative '../lib/journal_config.rb'
require 'optparse'

module JournalCli
  def self.parse
    options = {}
    OptionParser.new do |opts|
      opts.banner = "Usage: jou [options]"

      opts.on("-a description", "Add an entry") do |entry|
        options[:add] = entry
      end
      opts.on("-f file", "Temporarily use another journal file") do |file|
        options[:file] = file
      end
    end.parse!

    raise OptionParser::MissingArgument if options[:add].nil?

    # The -f parameter is required until a config file solution is available
    raise OptionParser::MissingArgument if options[:file].nil?

    j = Journal.new(options[:file])

    # Since there is no file to read on the first run, skip reading it
    j.serialize unless JournalConfig.config[:first_run]

    j.add(options[:add])
    puts "Adding entry to journal: #{options[:add]}"
    j.reverse_sort
    j.deserialize
  end
end

JournalCli.parse